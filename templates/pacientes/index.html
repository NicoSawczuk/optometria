{%extends 'home/home.html'%}
{%load static%}

{%block titulo%} Pacientes {%endblock titulo%}

{%block body%}

<div class="card">
    <div class="card-header bg-light">
        <strong>Pacientes</strong>
        <a class="btn btn-primary btn-sm float-right text-white" href="/home/pacientes/create">Nuevo</a>
    </div>
    <div class="card-body card-block">
        <table id="datatable" class="table table-striped table-bordered dataTable">
            <thead>
                <tr>
                    <th scope="col">Nombre</th>
                    <th scope="col">Apellido</th>
                    <th scope="col">F. Nacimiento</th>
                    <th scope="col">Sexo</th>
                    <th scope="col" class="text-right">Opciones</th>
                </tr>
            </thead>
            <tbody>
                {% for paciente in pacientes %}
                <tr>
                    <td>{{paciente.nombre}}</td>
                    <td>{{paciente.apellido}}</td>
                    <td>{{paciente.fecha_nac}}</td>
                    <td>{{paciente.sexo}}</td>

                    <td class="text-right">
                        <a title="Editar" class="btn btn-light btn-sm"
                            href="/home/pacientes/edit/{{paciente.id}}"><i class="fal fa-edit fa-lg"></i></a>
                        <a title="Observaciones" class="btn btn-light btn-sm"
                            onclick="openModalObservacion('{{paciente.id}}')"><i class="fal fa-book-medical fa-lg"></i></a>
                    </td>
                </tr>
                {%endfor%}
            </tbody>
        </table>
    </div>
</div>

<div id="observacionesModal" class="modal fade bd-example-modal-xl" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Observaciones</h2>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <ul class="list-group list-group-flush">
                    <div id="observaciones"></div>

                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

{%endblock body%}
{%block scripts%}
{{ block.super }}
{% if messages %}
{% for message in messages %}
{% if message.tags == 'success'%}
<script>
    toastr.success(' {{message}} ', 'Correcto')
</script>
{%endif%}
{% if message.tags == 'error'%}
<script>
    toastr.error(' {{message}} ', 'Error')
</script>
{%endif%}
{% endfor %}
{% endif %}

<script>

    function openModalObservacion(id) {
        $('#observacionesModal').modal('show');

        $('#inputNuevaObservacion').val(id)
        $.ajax({
            data: { 'id': id },
            url: '/home/pacientes/observaciones', //El id que estoy guardando en data se va a enviar en esa url
            type: 'get',
            success: function (data) {
                var html = ""
                console.log(data)

                for (var i = 0; i < data.length; i++) {
                    html += '<li class="list-group-item">' + '<div class="row">' +
                        '<div class="col-9">'
                        + data[i].fields.detalle +
                        '</div>' +
                        '<div class="col-3 text-muted">'
                        + data[i].fields.fecha.substring(8, 10) +'/'+ data[i].fields.fecha.substring(5, 7)+ '/'+data[i].fields.fecha.substring(0, 4) +
                        '</div>' +
                        '</div>' + '</li>'

                }
                $('#observaciones').html(html);

            },
        });
    }

</script>
{%endblock scripts%}